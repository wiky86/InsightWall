<!DOCTYPE html>
<html lang="ko" class="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insight Wall</title>
    <link rel="icon" type="image/png" href="wall.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --background: 0 0% 100%;
            --foreground: 240 10% 3.9%;
            --card: 0 0% 100%;
            --card-foreground: 240 10% 3.9%;
            --popover: 0 0% 100%;
            --popover-foreground: 240 10% 3.9%;
            --primary: 240 5.9% 10%;
            --primary-foreground: 0 0% 98%;
            --secondary: 240 4.8% 95.9%;
            --secondary-foreground: 240 5.9% 10%;
            --muted: 240 4.8% 95.9%;
            --muted-foreground: 240 3.8% 46.1%;
            --accent: 240 4.8% 95.9%;
            --accent-foreground: 240 5.9% 10%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 0 0% 98%;
            --border: 240 5.9% 90%;
            --input: 240 5.9% 90%;
            --ring: 240 5.9% 10%;
            --radius: 0.5rem;
        }

        .dark {
            --background: 240 10% 3.9%;
            --foreground: 0 0% 98%;
            --card: 240 10% 3.9%;
            --card-foreground: 0 0% 98%;
            --popover: 240 10% 3.9%;
            --popover-foreground: 0 0% 98%;
            --primary: 0 0% 98%;
            --primary-foreground: 240 5.9% 10%;
            --secondary: 240 3.7% 15.9%;
            --secondary-foreground: 0 0% 98%;
            --muted: 240 3.7% 15.9%;
            --muted-foreground: 240 5% 64.9%;
            --accent: 240 3.7% 15.9%;
            --accent-foreground: 0 0% 98%;
            --destructive: 0 62.8% 30.6%;
            --destructive-foreground: 0 0% 98%;
            --border: 240 3.7% 15.9%;
            --input: 240 3.7% 15.9%;
            --ring: 240 4.9% 83.9%;
        }

        body {
            font-family: 'Pretendard', sans-serif;
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            transition: background-color 0.3s, color 0.3s;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            10%,
            30%,
            50%,
            70%,
            90% {
                transform: translateX(-4px);
            }

            20%,
            40%,
            60%,
            80% {
                transform: translateX(4px);
            }
        }

        .animate-shake {
            animation: shake 0.5s cubic-bezier(.36, .07, .19, .97) both;
        }

        .font-mono-nums {
            font-variant-numeric: tabular-nums;
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: { extend: { colors: { border: "hsl(var(--border))", input: "hsl(var(--input))", ring: "hsl(var(--ring))", background: "hsl(var(--background))", foreground: "hsl(var(--foreground))", primary: { DEFAULT: "hsl(var(--primary))", foreground: "hsl(var(--primary-foreground))" }, secondary: { DEFAULT: "hsl(var(--secondary))", foreground: "hsl(var(--secondary-foreground))" }, destructive: { DEFAULT: "hsl(var(--destructive))", foreground: "hsl(var(--destructive-foreground))" }, muted: { DEFAULT: "hsl(var(--muted))", foreground: "hsl(var(--muted-foreground))" }, accent: { DEFAULT: "hsl(var(--accent))", foreground: "hsl(var(--accent-foreground))" }, popover: { DEFAULT: "hsl(var(--popover))", foreground: "hsl(var(--popover-foreground))" }, card: { DEFAULT: "hsl(var(--card))", foreground: "hsl(var(--card-foreground))" } }, borderRadius: { lg: "var(--radius)", md: "calc(var(--radius) - 2px)", sm: "calc(var(--radius) - 4px)" } } }
        }
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) { document.documentElement.classList.add('dark') } else { document.documentElement.classList.remove('dark') }
    </script>
</head>

<body class="min-h-screen antialiased relative overflow-hidden">

    <div id="access-gate"
        class="fixed inset-0 z-[100] bg-background flex items-center justify-center p-4 transition-opacity duration-500">
        <div
            class="w-full max-w-sm flex flex-col items-center space-y-6 text-center animate-in fade-in zoom-in duration-500">
            <div class="rounded-full bg-secondary p-4 mb-2"><i data-lucide="lock"
                    class="w-8 h-8 text-muted-foreground"></i></div>
            <div class="space-y-2">
                <h1 class="text-2xl font-bold tracking-tight">Insight Wall</h1>
                <p class="text-muted-foreground text-sm">ë¶€ì„œ ë‚´ë¶€ ì¸ì›ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
            </div>
            <div class="w-full space-y-4">
                <div class="relative"><input type="password" id="gate-password"
                        class="flex h-11 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 text-center tracking-widest text-lg"
                        placeholder="â€¢â€¢â€¢â€¢" maxlength="20"></div>
                <p id="gate-error" class="text-sm text-red-500 font-medium hidden">ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                <button id="gate-submit"
                    class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-11 px-8 w-full">ì…ì¥í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <header
        class="sticky top-0 z-50 w-full border-b border-border/40 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
        <div class="container mx-auto px-6 h-14 flex items-center justify-between">
            <span class="font-bold text-lg tracking-tight flex items-center gap-2 cursor-pointer"
                onclick="closeBoard()">
                <i data-lucide="layout-dashboard" class="w-5 h-5"></i> Insight Wall
            </span>
            <div class="flex items-center space-x-4">
                <div
                    class="hidden sm:flex items-center space-x-4 text-xs font-medium text-muted-foreground bg-secondary/50 px-3 py-1.5 rounded-full font-mono-nums">
                    <div class="flex items-center gap-1.5"><span class="opacity-70">TODAY</span><span id="visit-today"
                            class="text-foreground font-bold transition-all duration-500">0</span></div>
                    <div class="w-px h-3 bg-border"></div>
                    <div class="flex items-center gap-1.5"><span class="opacity-70">TOTAL</span><span id="visit-total"
                            class="text-primary font-bold transition-all duration-500">0</span></div>
                </div>
                <button id="theme-toggle"
                    class="inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground h-9 w-9"><i
                        data-lucide="sun"
                        class="h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"></i><i
                        data-lucide="moon"
                        class="absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"></i><span
                        class="sr-only">í…Œë§ˆ ì „í™˜</span></button>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-6 py-8">
        <div id="main-dashboard" class="transition-opacity duration-300">
            <div class="mb-8 space-y-2">
                <h1 class="text-3xl font-bold tracking-tight">Insight Post</h1>
                <p class="text-muted-foreground">ìš°ë¦¬ì˜ ì¸ì‚¬ì´íŠ¸ë¥¼ ììœ ë¡­ê²Œ ê³µìœ í•´ì£¼ì„¸ìš”.</p>
            </div>
            <div id="poster-wall"
                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 items-start">
                <!-- Skeleton Loading UI -->
                <div class="col-span-full grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    ${Array(4).fill(0).map(() => `
                    <div
                        class="rounded-xl border bg-card text-card-foreground shadow-sm h-[300px] flex flex-col p-6 space-y-4">
                        <div class="h-6 w-1/3 bg-muted rounded animate-pulse"></div>
                        <div class="h-4 w-2/3 bg-muted rounded animate-pulse"></div>
                        <div class="space-y-2 mt-4">
                            <div class="h-12 w-full bg-muted/50 rounded animate-pulse"></div>
                            <div class="h-12 w-full bg-muted/50 rounded animate-pulse"></div>
                            <div class="h-12 w-full bg-muted/50 rounded animate-pulse"></div>
                        </div>
                    </div>
                    `).join('')}
                </div>
            </div>
        </div>

        <div id="board-view" class="hidden transition-opacity duration-300">
            <div class="mb-8 flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div class="space-y-1">
                    <button onclick="closeBoard()"
                        class="text-sm text-muted-foreground hover:text-foreground flex items-center gap-1 mb-2 transition-colors">
                        <i data-lucide="arrow-left" class="w-4 h-4"></i> Back to Dashboard
                    </button>
                    <h2 id="board-title" class="text-3xl font-bold tracking-tight flex items-center gap-3"></h2>
                    <p id="board-desc" class="text-muted-foreground"></p>
                </div>
                <button id="board-write-btn"
                    class="inline-flex items-center justify-center rounded-md text-sm font-medium bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2 transition-all active:scale-95 gap-2 whitespace-nowrap">
                    <i data-lucide="pen-line" class="w-4 h-4"></i> Write New
                </button>
            </div>
            <div class="relative mb-4 max-w-md">
                <i data-lucide="search"
                    class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"></i>
                <input id="board-search" type="text" placeholder="ì œëª©, í•´ì‹œíƒœê·¸, ì‘ì„±ì ê²€ìƒ‰..."
                    class="flex h-10 w-full rounded-md border border-input bg-background pl-10 pr-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2">
            </div>
            <div class="rounded-xl border bg-card text-card-foreground shadow-sm overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="border-b bg-muted/50">
                            <tr class="text-left text-muted-foreground">
                                <th class="h-12 px-4 font-medium w-2/3">ì œëª©</th>
                                <th class="h-12 px-4 font-medium whitespace-nowrap">ì‘ì„±ì</th>
                                <th class="h-12 px-4 font-medium text-right whitespace-nowrap">ë‚ ì§œ</th>
                            </tr>
                        </thead>
                        <tbody id="board-list" class="divide-y divide-border"></tbody>
                    </table>
                </div>
                <div id="no-result" class="hidden p-8 text-center text-muted-foreground">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>
        </div>
    </main>

    <div id="write-modal"
        class="fixed inset-0 z-50 bg-background/80 backdrop-blur-sm hidden items-center justify-center p-4 transition-all duration-300"
        role="dialog">
        <div
            class="w-full max-w-lg rounded-xl border bg-card text-card-foreground shadow-lg animate-in fade-in-0 zoom-in-95 max-h-[90vh] overflow-y-auto no-scrollbar">
            <div class="flex flex-col space-y-1.5 p-6">
                <h3 class="text-lg font-semibold leading-none tracking-tight">ìƒˆë¡œìš´ ì¸ì‚¬ì´íŠ¸ ê³µìœ </h3>
                <p class="text-sm text-muted-foreground">ë¶€ì„œì›ë“¤ê³¼ ê³µìœ í•  ìœ ìš©í•œ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
            </div>
            <div class="p-6 pt-0 grid gap-4">
                <div class="grid gap-2"><label class="text-sm font-medium leading-none"
                        for="modal-category">ì¹´í…Œê³ ë¦¬</label><select id="modal-category"
                        class="flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 appearance-none">
                        <option value="youtube">Trending Videos</option>
                        <option value="news">Industry News</option>
                        <option value="paper">Research Papers</option>
                        <option value="share">Team Insights</option>
                        <option value="meme">ğŸ˜‚ ë°ˆ ì €ì¥ì†Œ</option>
                    </select></div>
                <div class="grid gap-2"><label class="text-sm font-medium leading-none" for="modal-title">ì œëª© <span
                            class="text-red-500">*</span></label><input id="modal-title" required
                        class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
                        placeholder="ì˜ˆ: 2025ë…„ ìƒë°˜ê¸° íŠ¸ë Œë“œ ë¶„ì„"></div>
                <div class="grid gap-2"><label class="text-sm font-medium leading-none"
                        for="modal-tags">í•´ì‹œíƒœê·¸</label><input id="modal-tags"
                        class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
                        placeholder="ì˜ˆ: AI, íŠ¸ë Œë“œ, 2025 (ì‰¼í‘œë¡œ êµ¬ë¶„)"></div>
                <div class="grid gap-2"><label class="text-sm font-medium leading-none" for="modal-link">ê´€ë ¨ ë§í¬
                        (URL)</label><input id="modal-link" type="url"
                        class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
                        placeholder="https://..."></div>
                <div class="grid gap-2"><label class="text-sm font-medium leading-none"
                        for="modal-comment">ì½”ë©˜íŠ¸</label><textarea id="modal-comment"
                        class="flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 resize-none"
                        placeholder="ì´ ì •ë³´ì˜ í•µì‹¬ì´ë‚˜ íŒ€ì— ì ìš©í•  ì  ë“±ì„ ê°„ë‹¨íˆ ì ì–´ì£¼ì„¸ìš”."></textarea></div>
                <div class="grid gap-2"><label class="text-sm font-medium leading-none"
                        for="modal-author">ì‘ì„±ì</label><input id="modal-author"
                        class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"
                        placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"></div>
            </div>
            <div class="flex items-center p-6 pt-0 justify-end space-x-2">
                <button id="modal-close"
                    class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">ì·¨ì†Œ</button>
                <button id="modal-submit"
                    class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">ê³µìœ í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        // [í•„ìˆ˜] ë³¸ì¸ì˜ ì›¹ ì•± URL
        const GOOGLE_SHEET_API_URL = "https://script.google.com/macros/s/AKfycbz0gBzAsoQAFl96ZBk6m_hXCHysKr4dksflpXCuvnPD5VK1qiuXdGBUMYUqdGIOVEbJ/exec";

        // 'ë°ˆ ê²Œì‹œíŒ' ì¶”ê°€ë¨
        let groupedMockData = [
            { category: 'youtube', posterTitle: 'Trending Videos', description: 'ìµœì‹  ì—…ê³„ ê´€ë ¨ ìœ íŠœë¸Œ ì˜ìƒ', icon: 'youtube', items: [] },
            { category: 'news', posterTitle: 'Industry News', description: 'ë†“ì¹˜ë©´ ì•ˆ ë  ì£¼ìš” ë‰´ìŠ¤', icon: 'newspaper', items: [] },
            { category: 'paper', posterTitle: 'Research Papers', description: 'ì‹ ê¸°ìˆ  ë…¼ë¬¸ ë° ë¦¬í¬íŠ¸', icon: 'book-open', items: [] },
            { category: 'share', posterTitle: 'Team Insights', description: 'íŒ€ì›ë“¤ì˜ ììœ ë¡œìš´ ê³µìœ ', icon: 'lightbulb', items: [] },
            { category: 'meme', posterTitle: 'ğŸ˜‚ ë°ˆ ì €ì¥ì†Œ', description: 'ì¬ë¯¸ìˆëŠ” ë°ˆ, ìœ ë¨¸ ìë£Œ ê³µìœ ', icon: 'smile', items: [] }
        ];

        // ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (action=getData ì¶”ê°€)
        async function fetchData() {
            if (GOOGLE_SHEET_API_URL.includes("ì—¬ê¸°ì—_ì›¹ì•±_URLì„_ë¶™ì—¬ë„£ìœ¼ì„¸ìš”")) {
                document.getElementById('poster-wall').innerHTML = '<div class="col-span-full text-center py-10 text-red-500 font-bold">API URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì½”ë“œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</div>';
                return;
            }
            try {
                const response = await fetch(GOOGLE_SHEET_API_URL + "?action=getData");
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                processSheetData(data);
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('poster-wall').innerHTML = `<div class="col-span-full flex flex-col items-center justify-center py-10 text-muted-foreground gap-2"><i data-lucide="alert-triangle" class="w-10 h-10 text-red-500 mb-2"></i><p class="text-lg font-semibold text-foreground">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p><p class="text-sm">${error.message}</p></div>`;
                lucide.createIcons();
            }
        }

        function processSheetData(rawData) {
            groupedMockData.forEach(g => g.items = []);

            for (let i = rawData.length - 1; i >= 0; i--) {
                const row = rawData[i];

                // 1. ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì‹œíŠ¸ í—¤ë” ì´ë¦„ ë§¤ì¹­)
                // ì‹œíŠ¸ í—¤ë”ê°€ 'Date', 'Category' ì²˜ëŸ¼ ëŒ€ë¬¸ìë¡œ ì‹œì‘í•˜ë¯€ë¡œ ëŒ€ë¬¸ì í‚¤ë¥¼ ìš°ì„  í™•ì¸
                const title = row.Title || row.title || row.summary;
                const link = row.Link || row.link || row.url;
                const comment = row.Comment || row.comment || row.opinion;
                const author = row.Author || row.author || 'ìµëª…';
                const dateStr = row.Date || row.date || row.timestamp || '';
                const tags = row.Tags || row.tags || row.tag || '';

                // [ì¤‘ìš”] ì‹œíŠ¸ì— ì íŒ 'Category' ê°’ì„ ìµœìš°ì„ ìœ¼ë¡œ ì‚¬ìš©!
                // ê°’ì´ ì—†ìœ¼ë©´ íƒœê·¸ë‚˜ ì œëª©ìœ¼ë¡œ ì¶”ì¸¡(fallback)
                let rawCategory = row.Category || row.category || '';
                let targetCategory = 'share'; // ê¸°ë³¸ê°’

                if (rawCategory) {
                    // ì‹œíŠ¸ì— ì¹´í…Œê³ ë¦¬ê°€ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ì”€ (ì†Œë¬¸ìë¡œ ë³€í™˜í•˜ì—¬ ë¹„êµ)
                    targetCategory = rawCategory.toLowerCase();
                } else {
                    // ì‹œíŠ¸ì— ì¹´í…Œê³ ë¦¬ê°€ ë¹„ì–´ìˆì„ ë•Œë§Œ ì¶”ì¸¡ ë¡œì§ ê°€ë™
                    const combined = (tags + " " + title).toLowerCase();
                    if (combined.includes('news') || combined.includes('ë‰´ìŠ¤')) targetCategory = 'news';
                    else if (combined.includes('youtube') || combined.includes('ìœ íŠœë¸Œ')) targetCategory = 'youtube';
                    else if (combined.includes('paper') || combined.includes('ë…¼ë¬¸')) targetCategory = 'paper';
                    else if (combined.includes('meme') || combined.includes('ë°ˆ')) targetCategory = 'meme';
                }

                // ì œëª©ì´ ì—†ìœ¼ë©´ ìŠ¤í‚µ
                if (!title) continue;

                const group = groupedMockData.find(g => g.category === targetCategory);

                if (group) {
                    // ë‚ ì§œ ê³„ì‚° (NEW ë°°ì§€)
                    let isRecent = false;
                    if (dateStr) {
                        // 2025. 11. 11 ê°™ì€ í•œêµ­ì‹ ë‚ ì§œë„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ë¬¸ìì—´ ì •ë¦¬
                        const cleanDate = dateStr.replace(/\./g, '-').replace(' ì˜¤í›„', '').replace(' ì˜¤ì „', '');
                        const postDate = new Date(cleanDate);
                        const now = new Date();
                        const diffHours = (now - postDate) / (1000 * 60 * 60);
                        if (diffHours < 24) isRecent = true;
                    }

                    group.items.push({
                        title: title,
                        date: dateStr,
                        author: author,
                        tags: tags ? tags.split(',').map(t => t.trim()) : [],
                        link: link || '#',
                        comment: comment || '',
                        isNew: isRecent
                    });
                }
            }
            renderPosters();
        }

        // --- [ìˆ˜ì •ë¨] ë Œë”ë§ í•¨ìˆ˜ ---
        function renderPosters() {
            const wall = document.getElementById('poster-wall');
            wall.innerHTML = '';

            groupedMockData.forEach(group => {
                let itemsHTML = '';

                // ìµœëŒ€ 5ê°œë§Œ ë¯¸ë¦¬ë³´ê¸°
                group.items.slice(0, 5).forEach(item => {
                    let tagsHTML = (item.tags && item.tags.length > 0) ? `<div class="flex flex-wrap gap-1 mb-2">${item.tags.map(tag => `<span class="text-[10px] text-muted-foreground bg-muted px-1.5 py-0.5 rounded-sm">#${tag}</span>`).join('')}</div>` : '';
                    const clickAction = item.link && item.link !== '#' ? `onclick="window.open('${item.link}', '_blank')"` : '';

                    // [ìˆ˜ì •] item.isNewê°€ trueì¼ ë•Œë§Œ ë°°ì§€ í‘œì‹œ (ë””ìì¸ ê°œì„ )
                    const newBadge = item.isNew ? `<span class="ml-2 inline-flex items-center rounded-full border border-rose-500/30 bg-rose-500/10 px-2 py-0.5 text-[10px] font-bold text-rose-600 dark:text-rose-400 animate-pulse shadow-[0_0_10px_rgba(244,63,94,0.2)]">NEW</span>` : '';

                    itemsHTML += `
                    <div class="flex flex-col py-3 px-2 -mx-2 rounded-md hover:bg-accent hover:text-accent-foreground transition-all cursor-pointer group" ${clickAction}>
                        <div class="mb-1">
                            <span class="text-sm font-medium leading-snug group-hover:underline underline-offset-4">
                                ${item.title}
                            </span>
                            ${newBadge} </div>
                        ${tagsHTML}
                        <div class="flex justify-between items-center text-xs text-muted-foreground mt-auto">
                            <span class="flex items-center gap-1 opacity-80"><i data-lucide="user" class="w-3 h-3"></i> ${item.author}</span>
                            <span class="opacity-80">${item.date}</span>
                        </div>
                    </div>`;
                });

                if (group.items.length === 0) itemsHTML = `<div class="py-4 text-center text-sm text-muted-foreground">ì•„ì§ ê³µìœ ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;

                wall.innerHTML += `
                <div class="rounded-xl border bg-card text-card-foreground shadow-sm flex flex-col h-full">
                    <div class="flex flex-col space-y-1.5 p-6 pb-3">
                        <h3 class="text-lg font-semibold flex items-center gap-2"><i data-lucide="${group.icon}" class="w-5 h-5 text-primary"></i>${group.posterTitle}</h3>
                        <p class="text-sm text-muted-foreground">${group.description}</p>
                    </div>
                    <div class="p-6 pt-0 flex-1">
                        <div class="flex flex-col divide-y divide-border">${itemsHTML}</div>
                    </div>
                    <div class="flex items-center p-6 pt-0 gap-3 mt-auto">
                        <button onclick="openBoard('${group.category}')" class="flex-1 inline-flex items-center justify-center rounded-md text-sm font-medium border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-4 py-2 transition-all active:scale-95">View All</button>
                        <button onclick="openModal('${group.category}')" class="flex-1 inline-flex items-center justify-center rounded-md text-sm font-medium bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-4 py-2 transition-all active:scale-95 gap-1"><i data-lucide="pen-line" class="w-3.5 h-3.5"></i> Write</button>
                    </div>
                </div>`;
            });
            lucide.createIcons();
        }

        // í†µê³„ í•¨ìˆ˜ (ì„œë²„ í˜¸ì¶œ)
        async function initVisitorCounter() {
            try {
                const response = await fetch(GOOGLE_SHEET_API_URL + "?action=recordVisit");
                if (!response.ok) throw new Error(`Stats HTTP error! status: ${response.status}`);
                const stats = await response.json();
                if (stats.result === 'success') {
                    animateCounter('visit-today', stats.today);
                    animateCounter('visit-total', stats.total);
                } else {
                    throw new Error(stats.error);
                }
            } catch (error) {
                console.error('Error fetching stats:', error);
                animateCounter('visit-today', 0);
                animateCounter('visit-total', 0);
            }
        }
        function animateCounter(e, t) { const n = document.getElementById(e); let a = 0; const o = 1e3, r = performance.now(); function c(e) { const i = e - r, s = Math.min(i / o, 1), l = Math.floor(a + (t - a) * (1 - Math.pow(1 - s, 3))); n.textContent = l.toLocaleString(), s < 1 ? requestAnimationFrame(c) : n.textContent = t.toLocaleString() } requestAnimationFrame(c) }

        // --- [ìˆ˜ì •] ë‹¤í¬ëª¨ë“œ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ ---
        document.getElementById('theme-toggle').addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });

        // --- ë¹„ë°€ë²ˆí˜¸ ë¡œì§ (ì„œë²„ ì¸ì¦) ---
        const gate = document.getElementById("access-gate"),
            gatePw = document.getElementById("gate-password"),
            gateErr = document.getElementById("gate-error"),
            gateSubmit = document.getElementById("gate-submit");

        if ("true" === sessionStorage.getItem("insight_wall_auth")) {
            gate.style.display = "none";
            document.body.classList.remove("overflow-hidden");
        }

        async function unlock() {
            const pass = gatePw.value;
            if (!pass) {
                gatePw.focus();
                return;
            }

            gateSubmit.disabled = true;
            gateSubmit.innerText = 'í™•ì¸ ì¤‘...';
            gateErr.classList.add('hidden');

            try {
                const response = await fetch(GOOGLE_SHEET_API_URL + "?action=checkPassword&pass=" + encodeURIComponent(pass));
                if (!response.ok) throw new Error('ì„œë²„ í†µì‹  ì‹¤íŒ¨');
                const data = await response.json();

                if (data.result === 'success') {
                    sessionStorage.setItem("insight_wall_auth", "true");
                    gate.style.opacity = "0";
                    setTimeout(() => {
                        gate.style.display = "none";
                        document.body.classList.remove("overflow-hidden");
                    }, 500);
                } else {
                    throw new Error('ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜');
                }
            } catch (error) {
                console.error('Unlock error:', error.message);
                gateErr.classList.remove("hidden");
                gatePw.classList.add("animate-shake", "border-red-500", "ring-red-500");
                setTimeout(() => gatePw.classList.remove("animate-shake", "border-red-500", "ring-red-500"), 500);
                gatePw.value = "";
                gatePw.focus();
                gateSubmit.disabled = false;
                gateSubmit.innerText = 'ì…ì¥í•˜ê¸°';
            }
        }

        document.getElementById("gate-submit").addEventListener("click", unlock);
        gatePw.addEventListener("keypress", e => { "Enter" === e.key && unlock() });
        // --- ë¹„ë°€ë²ˆí˜¸ ë¡œì§ ë ---

        let currentCategory = "";
        const mainDash = document.getElementById("main-dashboard"),
            boardView = document.getElementById("board-view"),
            boardTitle = document.getElementById("board-title"),
            boardDesc = document.getElementById("board-desc"),
            boardList = document.getElementById("board-list"),
            boardWriteBtn = document.getElementById("board-write-btn"),
            boardSearch = document.getElementById("board-search"),
            noResult = document.getElementById("no-result");

        function openBoard(e) {
            currentCategory = e;
            const t = groupedMockData.find(t => t.category === e);
            if (t) {
                mainDash.classList.add("hidden");
                boardView.classList.remove("hidden");
                window.scrollTo(0, 0);
                boardTitle.innerHTML = `<i data-lucide="${t.icon}" class="w-8 h-8 text-primary"></i> ${t.posterTitle}`;
                boardDesc.textContent = t.description;
                boardWriteBtn.onclick = () => openModal(e);
                boardSearch.value = "";
                renderBoardList(t.items);
                lucide.createIcons();
            }
        }

        function closeBoard() {
            boardView.classList.add("hidden");
            mainDash.classList.remove("hidden");
        }

        function renderBoardList(e) {
            boardList.innerHTML = "";
            if (e.length === 0) {
                noResult.classList.remove("hidden");
            } else {
                noResult.classList.add("hidden");
                e.forEach(e => {
                    const t = e.isNew ? '<span class="ml-2 inline-flex items-center rounded-full border border-rose-500/30 bg-rose-500/10 px-2 py-0.5 text-[10px] font-bold text-rose-600 dark:text-rose-400 shadow-[0_0_8px_rgba(244,63,94,0.2)]">NEW</span>' : "";
                    const n = e.tags && e.tags.length > 0 ? `<div class="flex flex-wrap gap-1 mt-1">${e.tags.map(e => `<span class="text-[10px] text-muted-foreground bg-muted px-1.5 py-0.5 rounded-sm">#${e}</span>`).join("")}</div>` : "";
                    boardList.innerHTML += `<tr class="hover:bg-muted/50 transition-colors cursor-pointer group" onclick="window.open('${e.link}', '_blank')"><td class="p-4 align-top"><div class="font-medium hover:underline underline-offset-4 group-hover:text-primary transition-colors">${e.title}${t}</div>${n}</td><td class="p-4 text-muted-foreground align-top whitespace-nowrap"><div class="flex items-center gap-1"><i data-lucide="user" class="w-3 h-3"></i> ${e.author || "ìµëª…"}</div></td><td class="p-4 text-right text-muted-foreground align-top whitespace-nowrap">${e.date}</td></tr>`;
                });
                lucide.createIcons();
            }
        }

        boardSearch.addEventListener("input", e => {
            const t = e.target.value.toLowerCase();
            const n = groupedMockData.find(e => e.category === currentCategory);
            if (!n) return;
            const a = n.items.filter(e => (e.title && e.title.toLowerCase().includes(t)) || (e.author && e.author.toLowerCase().includes(t)) || (e.tags && e.tags.some(e => e.toLowerCase().includes(t))));
            renderBoardList(a);
        });

        const modal = document.getElementById("write-modal"),
            catSel = document.getElementById("modal-category");

        function openModal(e) {
            catSel.value = e;
            modal.classList.remove("hidden");
            modal.classList.add("flex");
        }

        function closeModal() {
            modal.classList.add("hidden");
            modal.classList.remove("flex");
            ["modal-title", "modal-tags", "modal-link", "modal-comment", "modal-author"].forEach(e => document.getElementById(e).value = "");
        }

        document.getElementById("modal-close").addEventListener("click", closeModal);
        modal.addEventListener("click", e => { e.target === modal && closeModal() });

        // 'ê³µìœ í•˜ê¸°' ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤ì œ ë°ì´í„° ì „ì†¡
        document.getElementById('modal-submit').addEventListener('click', async () => {
            const submitBtn = document.getElementById('modal-submit');
            const originalBtnText = submitBtn.innerText;
            const category = document.getElementById('modal-category').value;
            const title = document.getElementById('modal-title').value;
            const tags = document.getElementById('modal-tags').value;
            const link = document.getElementById('modal-link').value;
            const comment = document.getElementById('modal-comment').value;
            const author = document.getElementById('modal-author').value;

            if (!title) { alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); document.getElementById('modal-title').focus(); return; }

            submitBtn.disabled = true;
            submitBtn.innerText = 'ì €ì¥ ì¤‘...';

            const payload = { category, title, tags, link, comment, author };

            try {
                await fetch(GOOGLE_SHEET_API_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify(payload)
                });
                alert('ì„±ê³µì ìœ¼ë¡œ ê³µìœ ë˜ì—ˆìŠµë‹ˆë‹¤!');
                closeModal();
                setTimeout(() => {
                    fetchData();
                }, 1000);
            } catch (error) {
                console.error('Error submitting data:', error);
                alert('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerText = originalBtnText;
            }
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        initVisitorCounter();
        fetchData(); 
    </script>
</body>

</html>